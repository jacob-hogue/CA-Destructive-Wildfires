<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>California Wildfires</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/css/main.css">
  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }

    .controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
    }

    #titleBar {
      background-color: #333; /* Dark gray background */
      color: #f8f8f8; /* Off-white text */
      text-align: center; /* Center the text */
      padding: 15px; /* Add some padding */
      font-size: 24px; /* Font size for title */
      font-weight: bold; /* Bold font */
      position: relative; /* Position for layout */
      z-index: 10; /* Ensure it appears above the map */
    }

    #credit {
      font-size: 14px; /* Smaller font size for credit */
      position: absolute; /* Position it in the bottom right */
      bottom: 10px; /* Position it at the bottom */
      right: 10px; /* Position it at the right */
      color: white; /* Color for credit text */
      z-index: 10; /* Ensure it appears above the map */
    }

    .controls button {
      background-color: #333; /* Dark gray background */
      color: #f8f8f8; /* Off-white text */
      border: none; /* Remove border */
      padding: 10px 20px; /* Add padding */
      font-size: 16px; /* Font size for buttons */
      font-weight: bold; /* Bold font */
      border-radius: 25px; /* Rounded corners */
      cursor: pointer; /* Pointer cursor on hover */
      margin: 5px; /* Add some margin */
    }

    .controls button:hover {
      background-color: #555; /* Slightly lighter gray on hover */
    }

    #insetMapDiv {
      position: absolute;
      bottom: 10px;
      left: 10px;
      width: 200px;
      height: 200px;
      border: 2px solid #333; /* Border to match the title bar */
      z-index: 10; /* Ensure it appears above the main map */
    }
  </style>
  <script src="https://js.arcgis.com/4.30/"></script>
</head>
<body>
  <div id="titleBar">California Top 10 Deadliest Wildfires</div>
  <div id="viewDiv"></div>
  <div id="insetMapDiv"></div>
  <div class="controls">
    <button id="startAnimation">Start Animation</button>
    <button id="stopAnimation">Stop Animation</button>
  </div>
  <div id="credit">Â© 2024 Jacob Hogue</div>

  <script>
    require([
  "esri/Map",
  "esri/views/MapView",
  "esri/layers/TileLayer",
  "esri/WebMap",
  "esri/layers/FeatureLayer",
  "esri/layers/GeoJSONLayer",
  "esri/layers/GraphicsLayer",
  "esri/Graphic",
  "esri/geometry/Extent"
], function(Map, MapView,TileLayer, WebMap, FeatureLayer, GeoJSONLayer, GraphicsLayer, Graphic, Extent) {

      // Create a WebMap instance using the web map ID
      var webMap = new WebMap({
        portalItem: { // autocasts as new PortalItem()
          id: "66b8501f53af47e6ae981214c4d9a32a" // your web map ID
        }
      });

      // Create a MapView instance
      var mapView = new MapView({
        container: "viewDiv", // Div element to contain the view
        map: webMap,
        center: [-118.805, 34.027], // [longitude, latitude]
        zoom: 10 // Zoom level
      });

      // Create a GraphicsLayer with overall transparency
      var graphicsLayer = new GraphicsLayer({
        opacity: 0.86 // Set overall transparency to 14%
      });
      webMap.add(graphicsLayer);

      // Create a GeoJSONLayer instance
      var geojsonLayer = new GeoJSONLayer({
        url: "https://raw.githubusercontent.com/jacob-hogue/Deadly-Wildfires-New/main/Deadliest10.geojson",
        title: "California Top 10 Deadliest Wildfires"
      });

      // Add the GeoJSONLayer to the map
      webMap.add(geojsonLayer);

      // Create a GraphicsLayer for centroids
      var centroidLayer = new GraphicsLayer();
      webMap.add(centroidLayer);

    const worldImagery = new TileLayer({
        portalItem: {
            id: "a66bfb7dd3b14228bf7ba42b138fe2ea",
        },
    });

      const insetMap = new Map({
        layers: [worldImagery],
    });


  // Create a MapView for the inset map
  var insetMapView = new MapView({
    container: "insetMapDiv",
    map: insetMap,
    center: [-119.974054,37.451040], // Center of California
    zoom: 4, // Zoom level to show all of California
    ui: {
      components: [] // Remove default UI components
    }
  });

  // Add FeatureLayer for State Boundary only to the inset map
  var stateBoundaryLayer = new FeatureLayer({
    url: "https://services3.arcgis.com/fdvHcZVgB2QSRNkL/arcgis/rest/services/State_Boundary/FeatureServer/0",
    renderer: {
      type: "simple", // autocasts as new SimpleRenderer()
      symbol: {
        type: "simple-fill", // autocasts as new SimpleFillSymbol()
        color: [0, 0, 0, 0], // No fill (fully transparent)
        outline: {
          color: "white", // White outline
          width: 0.5 // Thin outline
        }
      }
    },
    blendMode: "destination-out",
    opacity: 1, // Full opacity for the outline
    title: "State Boundary",
    minScale: 0,  // Make sure the layer is visible at any zoom level (no minScale)
    maxScale: 0   // No upper scale limit, always visible
  });

  // Add the state boundary layer only to the inset map
  insetMap.add(stateBoundaryLayer);


      // Create a GraphicsLayer for the inset map bounding box
      var insetGraphicsLayer = new GraphicsLayer();
      insetMap.add(insetGraphicsLayer);

      // Wait until the layer is loaded
      geojsonLayer.when(function() {
        // Convert GeoJSON features to graphics
        geojsonLayer.queryFeatures().then(function(results) {
          results.features.forEach(function(feature) {
            var graphic = new Graphic({
              geometry: feature.geometry,
              attributes: feature.attributes,
              symbol: {
                type: "simple-fill",
                color: "#fc7b4c", // Solid fill color
                outline: {
                  color: "#9979d1", // Solid outline color
                  width: 1
                }
              }
            });
            graphicsLayer.add(graphic);

            // Generate centroid for each feature
            var centroid = feature.geometry.centroid;
            var centroidGraphic = new Graphic({
              geometry: centroid,
              attributes: feature.attributes,
              symbol: {
                type: "simple-marker",
                color: [0, 0, 0, 0], // Fully transparent fill
                outline: {
                  color: [0, 0, 0, 0], // Fully transparent outline
                  width: 0
                }
              }
            });
            centroidLayer.add(centroidGraphic);
          });

          // Apply blend mode and layer effect
          graphicsLayer.blendMode = "color-dodge"; // Example blend mode
          graphicsLayer.effect = "bloom(0.2, 3.1px, 0.1)"; // Updated bloom effect

          // Remove the GeoJSONLayer after conversion
          webMap.remove(geojsonLayer);
        });
      });

      // Animation logic
      var objectIDs = [1819, 2447, 9576, 7166, 1215, 3243, 5880, 2214, 1877, 1199];
      var currentIndex = 0;
      var animationTimeout;
      var animationActive = false;

      function zoomToFire(extent) {
        mapView.goTo({
          target: extent,
          duration: 4000, // Duration for the animation (in milliseconds)
          easing: "in-out-cubic" // Smoother transition
        });

        // Update the inset map with a bounding box
        insetGraphicsLayer.removeAll();
        var insetGraphic = new Graphic({
          geometry: extent,
          symbol: {
            type: "simple-fill",
            color: [0, 0, 0, 0], // Transparent fill
            outline: {
              color: "#fc7b4c", // Red outline
              width: 2
            }
          }
        });
        insetGraphicsLayer.add(insetGraphic);
      }

      function startAnimation() {
        if (animationActive) return;
        animationActive = true;

        function animate() {
          if (currentIndex >= objectIDs.length) {
            currentIndex = 0; // Loop back to the first fire
          }

          var graphic = graphicsLayer.graphics.find(function(g) {
            return g.attributes.OBJECTID === objectIDs[currentIndex];
          });

          if (graphic) {
            zoomToFire(graphic.geometry.extent.expand(1.5));

            // Hide all other fire extents
            graphicsLayer.graphics.forEach(function(g) {
              g.visible = false;
            });

            // Show only the current fire extent
            graphic.visible = true;

            currentIndex++; // Move to the next fire
          }

          animationTimeout = setTimeout(animate, 10000); // Pause for 10 seconds
        }

        animate();
      }

      function stopAnimation() {
        if (animationActive) {
          clearTimeout(animationTimeout);
          animationActive = false;
        }
      }

      document.getElementById("startAnimation").addEventListener("click", function() {
        startAnimation();
      });

      document.getElementById("stopAnimation").addEventListener("click", function() {
        stopAnimation();
      });
    });
  </script>
  </body>
</html>
